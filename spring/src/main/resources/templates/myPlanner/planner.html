<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/common :: head(title)" />
<head>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.8/index.global.min.js"></script>
  <meta name="_csrf" th:content="${_csrf.token}"/>
  <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
  <style>
    .cc-selector input{
        margin:0;padding:0;
        -webkit-appearance:none;
           -moz-appearance:none;
                appearance:none;

        cursor:pointer;
        background-size:contain;
        background-repeat:no-repeat;
        display:inline-block;
        width:100px;height:70px;
        -webkit-transition: all 100ms ease-in;
           -moz-transition: all 100ms ease-in;
                transition: all 100ms ease-in;
        -webkit-filter: brightness(0) grayscale(1) opacity(1);
           -moz-filter: brightness(0) grayscale(1) opacity(1);
                filter: brightness(0) grayscale(1) opacity(1);
    }
    #vacation{background-image:url(img/eventType/vacation.png);}
    #diet{background-image:url(img/eventType/diet.png);}
    #shopping{background-image:url(img/eventType/shopping.png);}
    #place{background-image:url(img/eventType/place.png);}
    #text{background-image:url(img/eventType/text.png);}


    .cc-selector input:hover{
        -webkit-filter: brightness(1.2) grayscale(.5) opacity(.9);
           -moz-filter: brightness(1.2) grayscale(.5) opacity(.9);
                filter: brightness(1.2) grayscale(.5) opacity(.9);
    }

    .cc-selector input:checked {
        -webkit-filter: none;
           -moz-filter: none;
                filter: none;
    }

    #diet_pagingul, #px_pagingul{
        text-align: center;
        display: inline-block;
        border: 1px solid #ccc;
        border-right: 0;
        padding-left :0;
    }

    #diet_pagingul li, #px_pagingul li {
        text-align: center;
        float: left;
        list-style:none;

    }

    #diet_pagingul li a, #px_pagingul li a {
        display: block;
        font-size: 14px;
        color: black;
        padding: 9px 12px;
        border-right: solid 1px #ccc;
        box-sizing: border-box;
        text-decoration-line:none;
    }

    #diet_pagingul li.on, #px_pagingul li.on {
        background: #eda712;
    }

    #diet_pagingul li.on a, #px_pagingul li.on a {
        color: #fff;
    }

  </style>
</head>
<body>
<nav th:replace="fragments/common :: menu(menu)" />
<div id='calendar'></div>
<!-- 이벤트 유형 선택 modal -->
<div class="modal fade" id="type_event_modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="type_event_title">일정 유형을 선택하세요.</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <form class = "modal-body">
                <div class="cc-selector">
                    <div>
                        <input type="radio" class="type_event_input" id="vacation" value="vacation" name="type_event">
                        <label for="vacation">휴가</label>
                    </div>
                    <div>
                        <input type="radio" class="type_event_input" id="diet" value="diet" name="type_event">
                        <label for="diet">식단</label>
                    </div>
                    <div>
                        <input type="radio" class="type_event_input" id="shopping" value="shopping" name="type_event" >
                        <label for="shopping">소비</label>
                    </div>
                    <div>
                        <input type="radio" class="type_event_input" id="place" value="place" name="type_event">
                        <label for="place">장소</label>
                    </div>
                    <div>
                        <input type="radio" class="type_event_input" id="text" value="text" name="type_event">
                        <label for="text">텍스트로 입력하기</label>
                    </div>
                </div>
            </form>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="type_event_save">선택</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="type_event_modal_close">취소</button>
            </div>
        </div>
    </div>
</div>
<!-- 이벤트 추가 modal -->
<div class="modal fade" id="add_event_modal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="add_event_title">일정을 입력하세요.</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="eventText" class="form-group">
          <div class="form-check">
            <input class="form-check-input" type="radio" id="all_time" name="all_or_set_time" onchange="setTimeDisplay()" checked="checked">
            <label class="form-check-label all_time" for="all_time">종일</label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="radio" id="set_time" name="all_or_set_time" onchange="setTimeDisplay()">
            <label class="form-check-label set_time" for="set_time">시간 지정</label>
          </div>
          <label for="add_event_start_date" class="col-form-label">시작 날짜</label>
          <input type="date" class="form-control" id="add_event_start_date" name="calendar_start_date">
          <label for="add_event_start_time" class="col-form-label">시작 시간</label>
          <input type="time" class="form-control" id="add_event_start_time" name="calendar_start_time" disabled="true" value="00:00">
          <label for="add_event_end_date" class="col-form-label">종료 날짜</label>
          <input type="date" class="form-control" id="add_event_end_date" name="calendar_end_date">
          <label for="add_event_end_time" class="col-form-label">종료 시간</label>
          <input type="time" class="form-control" id="add_event_end_time" name="calendar_end_time" disabled="true" value="00:00">
          <div id="vacation_input">
              <label for="add_event_vacation" class="col-form-label">휴가 내역</label>
              <input type="text" class="form-control" id="add_event_vacation" name="calendar_content" disabled="true">
          </div>
          <div id="diet_input">
              <label for="diet_input" class="col-form-label">식단 추가 (기호 단위는 생략)</label>
              <input type="text" id="diet_title" class="form-control" name="calendar_content" placeholder="제목 예) 점심 식단" value="" disabled="true">
              <p></p>
              <div class= "buttons" id="diet_buttons">
                  <input type="button" id="add_diet_by_api" class="btnAdd btn btn-dark" value="음식 영양소 검색 추가">
                  <input type="button" id="add_diet_by_text" class="btn btn-outline-secondary" value="텍스트로 추가">
              </div>
              <input type="text" id="food_name" class="form-control" name="calendar_content" placeholder="음식명 예) 김치찌개, 쌀밥, 김치" value="" disabled="true">
              <input type="number" id="kcal" class="form-control" name="calendar_content" placeholder="1회 섭취 열량 합(kcal)" disabled="true">
              <input type="number" id="carbohydrate" class="form-control" name="calendar_content" placeholder="1회 섭취 탄수화물 합(g)" disabled="true">
              <input type="number" id="protein" class="form-control" name="calendar_content" placeholder="1회 섭취 단백질 합(g)" disabled="true">
              <input type="number" id="fat" class="form-control" name="calendar_content" placeholder="1회 섭취 지방 합(g)" disabled="true">
              <input type="number" id="sugar" class="form-control" name="calendar_content" placeholder="1회 섭취 당류 합(g)" disabled="true">
              <input type="number" id="salt" class="form-control" name="calendar_content" placeholder="1회 섭취 나트륨 합(g)" disabled="true">
              <input type="number" id="cholesterol" class="form-control" name="calendar_content" placeholder="1회 섭취 콜레스테롤 합(g)" disabled="true">
              <input type="number" id="saturatedFattyAcids" class="form-control" name="calendar_content" placeholder="1회 섭취 포화지방산 합(g)" disabled="true">
              <input type="number" id="transFattyAcids" class="form-control" name="calendar_content" placeholder="1회 섭취 트랜스지방산 합(g)" disabled="true">
          </div>
          <div id="shopping_input">
              <label for="shopping_input" class="col-form-label">소비 기록 추가</label>
              <input type="text" id="shopping_title" class="form-control" name="calendar_content" placeholder="제목 예) 점심 식단" value="" disabled="true">
              <p></p>
              <div class= "buttons" id="shopping_buttons">
                  <input type="button" id="add_shopping_by_px_api" class="btnAdd btn btn-dark" value="px 물품 검색 추가">
                  <input type="button" id="add_shopping_by_text" class="btn btn-outline-secondary" value="텍스트로 추가">
              </div>
              <input type="text" id="shopping_name" class="form-control" name="calendar_content" placeholder="상품명 + 금액" value="" disabled="true">
              <input type="number" id="total_price" class="form-control" name="calendar_content" placeholder="총 금액 (원)" disabled="true">
          </div>
          <div id="place_input">
              <label for="place_input" class="col-form-label">장소 추가</label>
              <input type="text" id="place_title" class="form-control" name="calendar_content" placeholder="제목 예) 숙소, 식사 ..." value="" disabled="true">
              <table class="table table-hover" id="likedPlace" style="font-size: 1vh">
                  <thead id="likedPlace_table_head">
                  <tr>
                      <th scope="col">장소명</th>
                      <th scope="col">주소</th>
                  </tr>
                  </thead>
                  <tbody id="likedPlace_body"></tbody>
              </table>
          </div>
          <div id="text_input">
              <label for="add_event_text" class="col-form-label">텍스트 추가</label>
              <input type="text" class="form-control" id="add_event_text" name="calendar_content" disabled="true">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-primary" id="add_event_save">추가</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="add_event_modal_close">취소</button>
      </div>
    </div>
  </div>
</div>

<!-- 이벤트 상세 정보 modal -->
<div class="modal fade" id="info_event_modal" tabindex="-1" role="dialog" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="info_event_title">일정 정보</h5>
        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
          <label for="info_event_start_date" class="col-form-label">시작 날짜</label>
          <input type="date" class="form-control" id="info_event_start_date" name="info_calendar_start_date" disabled="true">
          <label for="info_event_start_time" class="col-form-label">시작 시간</label>
          <input type="time" class="form-control" id="info_event_start_time" name="info_calendar_start_time" disabled="true">
          <label for="info_event_end_date" class="col-form-label">종료 날짜</label>
          <input type="date" class="form-control" id="info_event_end_date" name="info_calendar_end_date" disabled="true">
          <label for="info_event_end_time" class="col-form-label">종료 시간</label>
          <input type="time" class="form-control" id="info_event_end_time" name="info_calendar_end_time" disabled="true">
          <div id="vacation_info">
              <label for="info_event_vacation" class="col-form-label">휴가 내용</label>
              <input type="text" class="form-control" id="info_event_vacation" name="info_calendar_text" disabled="true">
          </div>
          <div id="diet_info">
              <fieldset id="info_event_diet" disabled="true">
                  <label for="diet_title_info" class="col-form-label">식단 제목</label>
                  <input type="text" id="diet_title_info" class="form-control" name="info_event_diet">
                  <label for="info_event_diet_info" class="col-form-label">식단 내용</label>
                  <fieldset id="info_event_diet_info">
                      <input type="text" id="food_name_info" class="form-control" name="info_event_diet">
                      <input type="number" id="kcal_info" class="form-control" name="info_event_diet">
                      <input type="number" id="carbohydrate_info" class="form-control" name="info_event_diet">
                      <input type="number" id="protein_info" class="form-control" name="info_event_diet">
                      <input type="number" id="fat_info" class="form-control" name="info_event_diet">
                      <input type="number" id="sugar_info" class="form-control" name="info_event_diet">
                      <input type="number" id="salt_info" class="form-control" name="info_event_diet">
                      <input type="number" id="cholesterol_info" class="form-control" name="info_event_diet">
                      <input type="number" id="saturatedFattyAcids_info" class="form-control" name="info_event_diet">
                      <input type="number" id="transFattyAcids_info" class="form-control" name="info_event_diet">
                  </fieldset>
              </fieldset>
          </div>
          <div id="shopping_info">
              <fieldset id="info_event_shopping" disabled="true">
                  <label for="shopping_title_info" class="col-form-label">소비 기록 제목</label>
                  <input type="text" id="shopping_title_info" class="form-control" name="info_event_shopping">
                  <label for="info_event_shopping_info" class="col-form-label">소비 내용</label>
                  <fieldset id="info_event_shopping_info">
                      <input type="text" id="shopping_name_info" class="form-control" name="info_event_shopping">
                      <input type="number" id="totalPrice_info" class="form-control" name="info_event_shopping">
                  </fieldset>
              </fieldset>
          </div>
          <div id="place_info">
              <fieldset id="info_event_place" disabled="true">
                  <label for="place_title_info" class="col-form-label">장소 제목</label>
                  <input type="text" id="place_title_info" class="form-control" name="info_place_shopping">
                  <label for="info_event_place_info" class="col-form-label">장소 내용</label>
                  <fieldset id="info_event_place_info">
                      <input type="text" id="place_name_info" class="form-control" name="info_place_shopping">
                      <input type="text" id="place_address_info" class="form-control" name="info_place_shopping">
                  </fieldset>
                  <!-- 이미지 지도를 표시할 div 입니다 -->
                  <div id="staticMap" style="width:auto;height:350px;"></div>
              </fieldset>
          </div>
          <div id="text_info">
              <label for="info_event_text" class="col-form-label">일정 내용</label>
              <input type="text" class="form-control" id="info_event_text" name="info_calendar_text" disabled="true">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="info_event_modal_close">취소</button>
<!--        <button type="submit" class="btn btn-warning" id="event_update">수정</button>-->
        <button type="submit" class="btn btn-danger" id="event_delete">삭제</button>
      </div>
    </div>
  </div>
</div>

<!-- 식단 선택 api modal -->
<div class="modal fade" id="add_diet_by_api_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="add_diet_api_title">식단 정보</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body app">
                <div class="input-group mb-3">
                    <input type="text" id="food_name_input" class="form-control" placeholder="음식명을 입력해보세요." aria-label="Recipient's username" aria-describedby="button-addon2">
                    <button id="search_food" class="btn btn-outline-secondary" type="button">검색</button>
                </div>
                <span id="diet_displayCount"></span>
                <table class="table table-hover" id="diet_api" style="font-size: 1vh">
                    <thead id="diet_table_head">
                        <tr>
                            <th scope="col">식품명</th>
                            <th scope="col">1회제공량 (g)</th>
                            <th scope="col">열량 (kcal)</th>
                            <th scope="col">탄수화물(g)</th>
                            <th scope="col">단백질(g)</th>
                            <th scope="col">지방(g)</th>
                            <th scope="col">당류 (g)</th>
                            <th scope="col">나트륨 (g)</th>
                            <th scope="col">콜레스테롤 (g)</th>
                            <th scope="col">포화지방산 (g)</th>
                            <th scope="col">트랜스지방산 (g)</th>
                        </tr>
                    </thead>
                    <tbody id="diet_api_body"></tbody>
                </table>
                <ul id="diet_pagingul"></ul>
            </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="add_diet_modal_close">취소</button>
            </div>
        </div>
    </div>
</div>

<!-- 텍스트로 식단 추가 modal -->
<div class="modal fade" id="add_diet_by_text_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <label for="add_diet_by_text_form" class="col-form-label">텍스트로 식단 추가 (기호 단위는 생략해서 입력해주세요.)<br>한번에 하나씩 추가해주세요.</label>
                <form id="add_diet_by_text_form">
                    <input type="text" id="food_name_text" class="form-control" name="calendar_content" placeholder="음식명 예) 김치찌개, 쌀밥, 김치" >
                    <input type="number" id="servingSize_text" class="form-control" name="calendar_content" placeholder="1회 제공량(g)">
                    <input type="number" id="kcal_text" class="form-control" name="calendar_content" placeholder="1회 섭취 열량 합(kcal)">
                    <input type="number" id="carbohydrate_text" class="form-control" name="calendar_content" placeholder="1회 섭취 탄수화물 합(g)">
                    <input type="number" id="protein_text" class="form-control" name="calendar_content" placeholder="1회 섭취 단백질 합(g)">
                    <input type="number" id="fat_text" class="form-control" name="calendar_content" placeholder="1회 섭취 지방 합(g)">
                    <input type="number" id="sugar_text" class="form-control" name="calendar_content" placeholder="1회 섭취 당류 합(g)">
                    <input type="number" id="salt_text" class="form-control" name="calendar_content" placeholder="1회 섭취 나트륨 합(g)">
                    <input type="number" id="cholesterol_text" class="form-control" name="calendar_content" placeholder="1회 섭취 콜레스테롤 합(g)">
                    <input type="number" id="saturatedFattyAcids_text" class="form-control" name="calendar_content" placeholder="1회 섭취 포화지방산 합(g)">
                    <input type="number" id="transFattyAcids_text" class="form-control" name="calendar_content" placeholder="1회 섭취 트랜스지방산 합(g)">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="add_diet_by_text_save">추가</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="add_diet_by_text_modal_close">취소</button>
            </div>
        </div>
    </div>
</div>

<!-- px 물품 선택 api modal -->
<div class="modal fade" id="add_shopping_by_px_api_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="add_shopping_api_title">PX 물품 정보</h5>
                <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body app">
                <div class="input-group mb-3">
                    <input type="text" id="px_name_input" class="form-control" placeholder="상품을 입력해보세요." aria-label="Recipient's username" aria-describedby="button-addon2">
                    <button id="search_px" class="btn btn-outline-secondary" type="button">검색</button>
                </div>
                <span id="px_displayCount"></span>
                <table class="table table-hover" id="px_api" style="font-size: 1vh">
                    <thead id="px_table_head">
                    <tr>
                        <th scope="col">상품명</th>
                        <th scope="col">판매년도</th>
                    </tr>
                    </thead>
                    <tbody id="px_api_body"></tbody>
                </table>
                <ul id="px_pagingul"></ul>
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="add_px_modal_close">취소</button>
        </div>
    </div>
</div>

<!-- 텍스트로 소비 기록 추가 modal -->
<div class="modal fade" id="add_shopping_by_text_modal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <label for="add_diet_by_text_form" class="col-form-label">텍스트로 소비 기록 추가 <br>한번에 하나씩 추가해주세요.</label>
                <form id="add_shopping_by_text_form">
                    <input type="text" id="item_name_text" class="form-control" name="calendar_content" placeholder="상품명 예) OO컵라면" >
                    <input type="number" id="price" class="form-control" name="calendar_content" placeholder="금액">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="add_shopping_by_text_save">추가</button>
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="add_shopping_by_text_modal_close">취소</button>
            </div>
        </div>
    </div>
</div>



<footer th:replace="fragments/common :: footer"></footer>
</body>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3d7ccd2c2284f05d05ea7f9ae21515d9&libraries=services"></script>
<script>
   $(document).ready(function (){
      var token = $("meta[name='_csrf']").attr("content");
	  var header = $("meta[name='_csrf_header']").attr("content");

      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        headerToolbar : {
		  start : 'prev next today',
		  center : 'title',
		  end : 'dayGridMonth,dayGridWeek,dayGridDay,listMonth'
		},
		titleFormat : function(date) {
		  return date.date.year + '년 ' + (parseInt(date.date.month) + 1) + '월';
		},
		navLinks: true,
		selectable : true,
<!--		droppable : true,-->
<!--		editable : true,-->
		nowIndicator: true,
		locale: 'ko',
		googleCalendarApiKey: 'AIzaSyD7FEF1RyDXeRs5iUzQ865DTAeHlbT1vcM', //구글 캘린더 API KEY
		eventSources: [
          {
            url: 'myPlanner/api/events/',
            color: 'yellow',
            textColor: 'black'
          },
          {
            googleCalendarId : 'ko.south_korea#holiday@group.v.calendar.google.com', //구글 캘린더 아이디 - 공휴일 가져오기
            color: 'white',
            textColor: 'red'
          }
        ],
        select: function (arg) { // 드래그로 이벤트 생성.
          $("#type_event_modal").modal("show"); // modal 나타내기
          $("#type_event_save").off('click').on("click",function(){
              var eventType = $('input:radio[name="type_event"]:checked').val();
              if(eventType == "vacation" || eventType == "diet" || eventType == "shopping" || eventType == "place" || eventType == "text") {

                //선택한 날짜 받아오기
                document.getElementById("add_event_start_date").value = moment(arg.start).format('YYYY-MM-DD');
                document.getElementById("add_event_end_date").value = moment(arg.end).format('YYYY-MM-DD');
                document.getElementById("add_event_start_time").value = moment(arg.start).format('HH:mm');
                document.getElementById("add_event_end_time").value = moment(arg.end).format('HH:mm');

                $('#vacation_input').css('display','none');
                $('#diet_input').css('display','none');
                $('#shopping_input').css('display','none');
                $('#place_input').css('display','none');
                $('#text_input').css('display','none');

                if(eventType == "vacation") {
                  $('#vacation_input').css('display','block');
                  $('#add_event_vacation').attr('disabled', false);
                  $("#add_event_modal").modal("show");
                } else if(eventType == "diet") {
                  $('#diet_input').css('display','block');
                  $('#diet_title').attr('disabled', false);

                  $("#add_event_modal").modal("show");
                  $("#add_event_save").off('click').on("click",function(){  // modal의 일정 추가 버튼 클릭 시 - 식단
                      var diet_title = $("#diet_title").val();
                      var food_name = $("#food_name").val();
                      var kcal = $("#kcal").val();
                      var carbohydrate = $("#carbohydrate").val();
                      var protein = $("#protein").val();
                      var fat = $("#fat").val();
                      var sugar = $("#sugar").val();
                      var salt = $("#salt").val();
                      var cholesterol = $("#cholesterol").val();
                      var saturatedFattyAcids = $("#saturatedFattyAcids").val();
                      var transFattyAcids = $("#transFattyAcids").val();

                      var start_date = $("#add_event_start_date").val();
                      var start_time = $("#add_event_start_time").val();
                      var end_date = $("#add_event_end_date").val();
                      var end_time = $("#add_event_end_time").val();

                      var allDay = true;
                      if($('input:radio[id=set_time]').is(':checked')){
                        allDay = false;
                      }

                      var start = start_date + " " + start_time;
                      var end = end_date + " " + end_time;

                      //내용 입력 여부 확인
                      if(diet_title == null || diet_title == ""){
                        alert("제목을 입력해주세요.");
                      }else if(food_name == null || food_name == ""){
                        alert("식단을 입력해주세요.");
                      }else if(start_date == "" || end_date ==""){
                        alert("날짜를 입력해주세요.");
                      }else if(new Date(end)- new Date(start) < 0){ // date 타입으로 변경 후 확인
                        alert("종료일이 시작일보다 먼저입니다.");
                      }else{ // 정상적인 입력 시
                        var obj = {

                          "eventType" : "diet",
                          "title" : diet_title,
                          "start" : start,
                          "end" : end,
                          "allDay" : allDay,
                          "food_name" : food_name,
                          "kcal" : kcal,
                          "carbohydrate" : carbohydrate,
                          "protein" : protein,
                          "fat" : fat,
                          "sugar" : sugar,
                          "salt" : salt,
                          "cholesterol" : cholesterol,
                          "saturatedFattyAcids" : saturatedFattyAcids,
                          "transFattyAcids" : transFattyAcids,
                        }//전송할 객체 생성
                        var eventDiet = JSON.stringify(obj)
                        $.ajax({
                          url: "/myPlanner/create_diet",
                          method: "POST",
                          dataType: "text",
                          data: eventDiet,
                          contentType: 'application/json',
                          beforeSend : function(xhr) {
                            xhr.setRequestHeader(header, token);
                          },
                          success : function(){
                            alert("등록을 완료하였습니다!");
                          },
                          fail : function (request, status, error){
                            alert("에러 발생" + error)
                          },
                          complete : function(){
                            location.replace("");
                          }
                        })
                      }
                  });

                  $("#add_diet_by_text").off('click').on("click",function(){
                    $("#add_diet_by_text_modal").modal("show");

                    $(document).off('click').on('click', '#add_diet_by_text_save', function(){
                        if($('#food_name').val() !=""){
                            $('#food_name').val($('#food_name').val() + "/");
                        }
                        let food_name_text = `${$('#food_name_text').val()} (${$('#servingSize_text').val()}g)`;
                        $('#food_name').val($('#food_name').val() + food_name_text);

                        let add_kcal_text = ($('#kcal_text').val()!="") ? $('#kcal_text').val() : 0;
                        let add_carbohydrate_text = ($('#carbohydrate_text').val()!="") ? $('#carbohydrate_text').val() : 0;
                        let add_protein_text = ($('#protein_text').val()!="") ? $('#protein_text').val() : 0;
                        let add_fat_text = ($('#fat_text').val()!="") ? $('#fat_text').val() : 0;
                        let add_sugar_text = ($('#sugar_text').val()!="") ? $('#sugar_text').val() : 0;
                        let add_salt_text = ($('#salt_text').val()!="") ? $('#salt_text').val() : 0;
                        let add_cholesterol_text = ($('#cholesterol_text').val()!="") ? $('#cholesterol_text').val() : 0;
                        let add_saturatedFattyAcids_text = ($('#saturatedFattyAcids_text').val()!="") ? $('#saturatedFattyAcids_text').val() : 0;
                        let add_transFattyAcids_text = ($('#transFattyAcids_text').val()!="") ? $('#transFattyAcids_text').val() : 0;

                        $('#kcal').val((Number($('#kcal').val()) + Number(add_kcal_text)).toFixed(1));
                        $('#carbohydrate').val((Number($('#carbohydrate').val()) + Number(add_carbohydrate_text)).toFixed(1));
                        $('#protein').val((Number($('#protein').val()) + Number(add_protein_text)).toFixed(1));
                        $('#fat').val((Number($('#fat').val()) + Number(add_fat_text)).toFixed(1));
                        $('#sugar').val((Number($('#sugar').val()) + Number(add_sugar_text)).toFixed(1));
                        $('#salt').val((Number($('#salt').val()) + Number(add_salt_text)).toFixed(1));
                        $('#cholesterol').val((Number($('#cholesterol').val()) + Number(add_cholesterol_text)).toFixed(1));
                        $('#saturatedFattyAcids').val((Number($('#saturatedFattyAcids').val()) + Number(add_saturatedFattyAcids_text)).toFixed(1));
                        $('#transFattyAcids').val((Number($('#transFattyAcids').val()) + Number(add_transFattyAcids_text)).toFixed(1));

                        $("#add_diet_by_text_modal").modal("hide");
                    })
                  });

                  $("#add_diet_by_api").off('click').on("click",function(){
                    $("#add_diet_by_api_modal").modal("show");

                    let pageNo;
                    const numOfRows = 100;
                    let serviceKey = "YfVszWFGgZBtStWJ429k2RIkV3b1vpS4obo%2FKLxcU15enrSNaCvSNO3TLZKnGjaAfL3trm9jk6X7jFG86kpm6Q%3D%3D"
                    let totalPage;
                    let totalCount;
                    let resultCode;
                    let desc_kor = "";

                    let pageCount = 8; //페이징에 나타낼 페이지 수

                    let url;

                    //초기 렌더링
                    pageNo = 1;
                    url = `http://apis.data.go.kr/1471000/FoodNtrIrdntInfoService1/getFoodNtrItdntList1?ServiceKey=${serviceKey}&numOfRows=${numOfRows}&pageNo=${pageNo}&type=json`
                    init();
                    totalPage = Math.ceil(totalCount/numOfRows);
                    paging(totalCount, numOfRows, pageCount, pageNo);
                    displayData(pageNo);

                    $('#search_food').off('click').on("click", function(){
                        desc_kor = $('#food_name_input').val()
                        if(desc_kor == ""){
                            pageNo = 1;
                            url = `http://apis.data.go.kr/1471000/FoodNtrIrdntInfoService1/getFoodNtrItdntList1?ServiceKey=${serviceKey}&numOfRows=${numOfRows}&pageNo=${pageNo}&type=json`
                            init();
                            totalPage = Math.ceil(totalCount/numOfRows);
                            paging(totalCount, numOfRows, pageCount, pageNo);
                            displayData(pageNo);
                        }else{
                            pageNo = 1;
                            desc_kor = $('#food_name_input').val();
                            url = `http://apis.data.go.kr/1471000/FoodNtrIrdntInfoService1/getFoodNtrItdntList1?ServiceKey=${serviceKey}&numOfRows=${numOfRows}&pageNo=${pageNo}&type=json&desc_kor=${desc_kor}`;
                            init();
                            totalPage = Math.ceil(totalCount/numOfRows);
                            paging(totalCount, numOfRows, pageCount, pageNo);
                            displayData(pageNo);
                        }
                    });

                    //totalCount를 먼저 받아옴으로써 총 데이터의 갯수를 파악
                    function init() {
                        $.ajax({
                            type: "GET",
                            url: url,
                            data: {},
                            async: false,
                            success: function(data) {
                                totalCount = data.body.totalCount;
                                resultCode = data.header.resultCode;
                            }
                        })
                        if(resultCode != "00"){
                            alert("공공데이터 API에 문제가 있습니다! 잠시 후 다시 시도해주세요.");
                        }
                    }

                    //데이터 가져오기
                    function setTable(pageNo){
                        $.ajax({
                            type: "GET",
                            url: url,
                            data: {},
                            success: function(data){
                               resultCode = data.header.resultCode;
                               if(resultCode != "00"){
                                 alert("공공데이터 API에 문제가 있습니다! 잠시 후 다시 시도해주세요.");
                               }
                               let bodyData = data.body;
                               for (let i = 0; i < numOfRows; i++) {
                                    let table_html='';
                                    table_html += '<tr>';
                                    table_html += '  <td>'+bodyData.items[i]['DESC_KOR']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['SERVING_WT']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT1']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT2']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT3']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT4']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT5']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT6']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT7']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT8']+'</td>';
                                    table_html += '  <td>'+bodyData.items[i]['NUTR_CONT9']+'</td>';
                                    table_html += '</tr>';

                                    $('#diet_api_body').append(table_html);
                               }
                            }
                        })
                    }

                    function displayData(pageNo) {
                      $('#diet_api_body').empty();
                      if(desc_kor == ""){
                        url = `http://apis.data.go.kr/1471000/FoodNtrIrdntInfoService1/getFoodNtrItdntList1?ServiceKey=${serviceKey}&numOfRows=${numOfRows}&pageNo=${pageNo}&type=json`;
                      }else{
                        url = `http://apis.data.go.kr/1471000/FoodNtrIrdntInfoService1/getFoodNtrItdntList1?ServiceKey=${serviceKey}&numOfRows=${numOfRows}&pageNo=${pageNo}&type=json&desc_kor=${desc_kor}`;
                      }
                      setTable(pageNo);
                    }

                    function paging(totalCount, numOfRows, pageCount, pageNo) {

                      if(totalPage<pageCount){
                        pageCount=totalPage;
                      }

                      let pageGroup = Math.ceil(pageNo / pageCount); // 페이지 그룹
                      let last = pageGroup * pageCount; //화면에 보여질 마지막 페이지 번호

                      if (last > totalPage) {
                        last = totalPage;
                      }

                      let first = last - (pageCount - 1); //화면에 보여질 첫번째 페이지 번호
                      let next = last + 1;
                      let prev = first - 1;

                      let pageHtml = "";

                      if (prev > 0) {
                        pageHtml += "<li><a href='#' id='prev'> 이전 </a></li>";
                      }

                     //페이징 번호 표시
                      for (var i = first; i <= last; i++) {
                        if (pageNo == i) {
                          pageHtml +=
                            "<li class='on'><a href='#' id='" + i + "'>" + i + "</a></li>";
                        } else {
                          pageHtml += "<li><a href='#' id='" + i + "'>" + i + "</a></li>";
                        }
                      }

                      if (last < totalPage) {
                        pageHtml += "<li><a href='#' id='next'> 다음 </a></li>";
                      }

                      $("#diet_pagingul").html(pageHtml);
                      let displayCount = "";
                      displayCount = `현재 ${pageNo} - ${totalPage} 페이지 / ${totalCount}건`;
                      $("#diet_displayCount").text(displayCount);


                      //페이징 번호 클릭 이벤트
                      $("#diet_pagingul li a").click(function () {
                        let $id = $(this).attr("id");
                        selectedPage = $(this).text();

                        if ($id == "next") selectedPage = next;
                        if ($id == "prev") selectedPage = prev;

                        pageNo = selectedPage;
                        paging(totalCount, numOfRows, pageCount, pageNo);
                        displayData(pageNo);
                      });
                    }

                    $(document).off('click').on('click', '#diet_api_body>tr', function(){
                        var tr = $(this);
                        var td = tr.children();
                        if($('#food_name').val() !=""){
                            $('#food_name').val($('#food_name').val() + "/");
                        }
                        let food_name = `${td.eq(0).text()} (${td.eq(1).text()}g)`;
                        $('#food_name').val($('#food_name').val() + food_name);

                        let add_kcal = (td.eq(2).text()!="N/A") ? td.eq(2).text() : 0 ;
                        let add_carbohydrate = (td.eq(3).text()!="N/A") ? td.eq(3).text() : 0;
                        let add_protein = (td.eq(4).text()!="N/A") ? td.eq(4).text() : 0;
                        let add_fat = (td.eq(5).text()!="N/A") ? td.eq(5).text() : 0;
                        let add_sugar = (td.eq(6).text()!="N/A") ? td.eq(6).text() : 0;
                        let add_salt = (td.eq(7).text()!="N/A") ? td.eq(7).text() : 0;
                        let add_cholesterol = (td.eq(8).text()!="N/A") ? td.eq(8).text() : 0;
                        let add_saturatedFattyAcids = (td.eq(9).text()!="N/A") ? td.eq(9).text() : 0;
                        let add_transFattyAcids = (td.eq(10).text()!="N/A") ? td.eq(10).text() : 0;

                        $('#kcal').val((Number($('#kcal').val()) + Number(add_kcal)).toFixed(1));
                        $('#carbohydrate').val((Number($('#carbohydrate').val()) + Number(add_carbohydrate)).toFixed(1));
                        $('#protein').val((Number($('#protein').val()) + Number(add_protein)).toFixed(1));
                        $('#fat').val((Number($('#fat').val()) + Number(add_fat)).toFixed(1));
                        $('#sugar').val((Number($('#sugar').val()) + Number(add_sugar)).toFixed(1));
                        $('#salt').val((Number($('#salt').val()) + Number(add_salt)).toFixed(1));
                        $('#cholesterol').val((Number($('#cholesterol').val()) + Number(add_cholesterol)).toFixed(1));
                        $('#saturatedFattyAcids').val((Number($('#saturatedFattyAcids').val()) + Number(add_saturatedFattyAcids)).toFixed(1));
                        $('#transFattyAcids').val((Number($('#transFattyAcids').val()) + Number(add_transFattyAcids)).toFixed(1));


                        $("#add_diet_by_api_modal").modal("hide");
                    });
                  })
                } else if(eventType == "shopping") {
                  $('#shopping_input').css('display','block');
                  $('#shopping_title').attr('disabled', false);
                  $("#add_event_modal").modal("show");
                  $("#add_event_save").off('click').on("click",function(){  // modal의 일정 추가 버튼 클릭 시 - 쇼핑
                      var shopping_title = $("#shopping_title").val();
                      var shopping_name = $("#shopping_name").val();
                      var total_price = $("#total_price").val();

                      var start_date = $("#add_event_start_date").val();
                      var start_time = $("#add_event_start_time").val();
                      var end_date = $("#add_event_end_date").val();
                      var end_time = $("#add_event_end_time").val();

                      var allDay = true;
                      if($('input:radio[id=set_time]').is(':checked')){
                        allDay = false;
                      }

                      var start = start_date + " " + start_time;
                      var end = end_date + " " + end_time;

                      //내용 입력 여부 확인
                      if(shopping_title == null || shopping_title == ""){
                        alert("제목을 입력해주세요.");
                      }else if(shopping_name == null || shopping_name == ""){
                        alert("소비내용을 입력해주세요.");
                      }else if(start_date == "" || end_date ==""){
                        alert("날짜를 입력해주세요.");
                      }else if(new Date(end)- new Date(start) < 0){ // date 타입으로 변경 후 확인
                        alert("종료일이 시작일보다 먼저입니다.");
                      }else{ // 정상적인 입력 시
                        var obj = {
                          "eventType" : "shopping",
                          "title" : shopping_title,
                          "start" : start,
                          "end" : end,
                          "allDay" : allDay,
                          "shopping_name" : shopping_name,
                          "total_price" : total_price,
                        }//전송할 객체 생성
                        var eventShopping = JSON.stringify(obj)
                        $.ajax({
                          url: "/myPlanner/create_shopping",
                          method: "POST",
                          dataType: "text",
                          data: eventShopping,
                          contentType: 'application/json',
                          beforeSend : function(xhr) {
                            xhr.setRequestHeader(header, token);
                          },
                          success : function(){
                            alert("등록을 완료하였습니다!");
                          },
                          fail : function (request, status, error){
                            alert("에러 발생" + error)
                          },
                          complete : function(){
                            location.replace("");
                          }
                        })
                        calendar.unselect();
                      }
                  });

                  $("#add_shopping_by_px_api").off('click').on("click",function(){
                    $("#add_shopping_by_px_api_modal").modal("show");

                    let pageNo;
                    const numOfRows = 100;
                    let start;
                    let end;
                    let totalPage;
                    let totalCount;
                    let px_name = "";

                    let pageCount = 8; //페이징에 나타낼 페이지 수

                    let url;

                    //초기 렌더링
                    init();
                    totalPage = Math.ceil(totalCount/numOfRows);
                    url = `/myPlanner/getpxapi/${start}/${totalCount}`
                    paging(totalCount, numOfRows, pageCount, pageNo);
                    displayData();

                    $('#search_px').off('click').on("click", function(){
                        px_name = $('#px_name_input').val()
                        if(px_name == ""){
                            init();
                            totalPage = Math.ceil(totalCount/numOfRows);
                            url = `/myPlanner/getpxapi/${start}/${totalCount}`
                            paging(totalCount, numOfRows, pageCount, pageNo);
                            displayData();
                        }else{
                            px_name = $('#px_name_input').val();
                            search_init(px_name);
                            totalPage = Math.ceil(search_totalCount/numOfRows);
                            paging(search_totalCount, numOfRows, pageCount, pageNo);
                            search_displayData();
                        }
                    });

                    //totalCount를 먼저 받아옴으로써 api가 정상적인지와 총 데이터의 갯수를 파악
                    function init() {
                        pageNo = 1;
                        start = 1;
                        end = 1;
                        url = `/myPlanner/getpxapi/${start}/${end}`
                        $.ajax({
                            type: "GET",
                            url: url,
                            data: {},
                            async: false,
                            success: function(data) {
                                jsonData = JSON.parse(data); //string -> json
                                totalCount = jsonData.DS_MND_PX_PARD_PRDT_INFO.list_total_count;
                                if(jsonData.DS_MND_PX_PARD_PRDT_INFO == null || jsonData.DS_MND_PX_PARD_PRDT_INFO == ""){
                                 alert("공공데이터 API에 문제가 있습니다! 잠시 후 다시 시도해주세요.");
                                }
                            }
                        })
                    }

                    let search_totalCount;
                    //px 검색 했을 경우 init
                    function search_init(px_name) {
                        pageNo = 1;
                        start = 1;
                        end = totalCount;
                        url = `/myPlanner/getpxapi/${start}/${end}`
                        $.ajax({
                            type: "GET",
                            url: url,
                            data: {},
                            async: false,
                            success: function(data) {
                                jsonData = JSON.parse(data).DS_MND_PX_PARD_PRDT_INFO;; //string -> json
                                if(jsonData.DS_MND_PX_PARD_PRDT_INFO == null || jsonData.DS_MND_PX_PARD_PRDT_INFO == ""){
                                 alert("공공데이터 API에 문제가 있습니다! 잠시 후 다시 시도해주세요.");
                                }
                                actual_totalCount = jsonData.list_total_count;
                                search_totalCount = 0;
                                for (let i = 0; i < actual_totalCount; i++) {
                                    if((jsonData.row[i]['prdtnm']).includes(px_name)){
                                        search_totalCount += 1;
                                    }
                                }
                            }
                        })
                    }

                    //데이터 가져오기
                    function setTable(pageNo){
                        $.ajax({
                            type: "GET",
                            url: url,
                            data: {},
                            async: false,
                            success: function(data) {
                                let jsonData = JSON.parse(data).DS_MND_PX_PARD_PRDT_INFO; //string -> json
                                for (let i = 0; i < numOfRows; i++) {
                                    let table_html='';
                                    table_html += '<tr>';
                                    table_html += '  <td>'+jsonData.row[i]['prdtnm']+'</td>';
                                    table_html += '  <td>'+jsonData.row[i]['sellyear']+'</td>';
                                    table_html += '</tr>';

                                    $('#px_api_body').append(table_html);
                                }
                            }
                        })
                    }

                    function search_setTable(pageNo, px_name){
                        $.ajax({
                            type: "GET",
                            url: url,
                            data: {},
                            async: false,
                            success: function(data) {
                                let jsonData = JSON.parse(data).DS_MND_PX_PARD_PRDT_INFO; //string -> json
                                for (let i = 0; i < numOfRows; i++) {
                                     if((jsonData.row[i]['prdtnm']).includes(px_name)){
                                        let table_html='';
                                        table_html += '<tr>';
                                        table_html += '  <td>'+jsonData.row[i]['prdtnm']+'</td>';
                                        table_html += '  <td>'+jsonData.row[i]['sellyear']+'</td>';
                                        table_html += '</tr>';

                                        $('#px_api_body').append(table_html);
                                     }
                                }
                            }
                        })
                    }

                    function displayData() {
                      $('#px_api_body').empty();

                      $('#add_shopping_by_px_api_modal').scrollTop(0);
                      setTable(pageNo, px_name);
                    }

                    function search_displayData() {
                      $('#px_api_body').empty();

                      $('#add_shopping_by_px_api_modal').scrollTop(0);
                      search_setTable(pageNo, px_name);
                    }

                    function paging(totalCount, numOfRows, pageCount, pageNo) {

                      if(totalPage<pageCount){
                        pageCount=totalPage;
                      }

                      let pageGroup = Math.ceil(pageNo / pageCount); // 페이지 그룹
                      let last = pageGroup * pageCount; //화면에 보여질 마지막 페이지 번호

                      if (last > totalPage) {
                        last = totalPage;
                      }

                      let first = last - (pageCount - 1); //화면에 보여질 첫번째 페이지 번호
                      let next = last + 1;
                      let prev = first - 1;

                      let pageHtml = "";

                      if (prev > 0) {
                        pageHtml += "<li><a href='#' id='prev'> 이전 </a></li>";
                      }

                     //페이징 번호 표시
                      for (var i = first; i <= last; i++) {
                        if (pageNo == i) {
                          pageHtml +=
                            "<li class='on'><a href='#' id='" + i + "'>" + i + "</a></li>";
                        } else {
                          pageHtml += "<li><a href='#' id='" + i + "'>" + i + "</a></li>";
                        }
                      }

                      if (last < totalPage) {
                        pageHtml += "<li><a href='#' id='next'> 다음 </a></li>";
                      }

                      $("#px_pagingul").html(pageHtml);
                      let displayCount = "";
                      displayCount = `현재 ${pageNo} - ${totalPage} 페이지 / ${totalCount}건`;
                      $("#px_displayCount").text(displayCount);


                      //페이징 번호 클릭 이벤트
                      $("#px_pagingul li a").click(function () {
                        let $id = $(this).attr("id");
                        selectedPage = $(this).text();

                        if ($id == "next") selectedPage = next;
                        if ($id == "prev") selectedPage = prev;

                        pageNo = selectedPage;
                        start = ($id-1)*100 + 1;
                        end = start + 99;
                        url = `/myPlanner/getpxapi/${start}/${end}`;
                        paging(totalCount, numOfRows, pageCount, pageNo);
                        displayData(pageNo);
                      });
                    }

                    $(document).off('click').on('click', '#px_api_body>tr', function(){
                        let price = prompt('가격을 입력해주세요. 공백 시 0원','0');
                        var tr = $(this);
                        var td = tr.children();
                        if($('#shopping_name').val() !=""){
                            $('#shopping_name').val($('#shopping_name').val() + "/");
                        }
                        let shopping_name = `${td.eq(0).text()} (${price}원)`;
                        $('#shopping_name').val($('#shopping_name').val() + shopping_name);
                        $('#total_price').val((Number($('#total_price').val()) + Number(price)));

                        $("#add_shopping_by_px_api_modal").modal("hide");
                    });

                  });
                  $("#add_shopping_by_text").off('click').on("click",function(){
                    $("#add_shopping_by_text_modal").modal("show");

                    $(document).off('click').on('click', '#add_shopping_by_text_save', function(){
                        if($('#shopping_name').val() !=""){
                            $('#shopping_name').val($('#shopping_name').val() + "/");
                        }
                        let shopping_name = `${$('#item_name_text').val()} (${$('#price').val()}원)`;
                        $('#shopping_name').val($('#shopping_name').val() + shopping_name);
                        $('#total_price').val((Number($('#total_price').val()) + Number($('#price').val())));

                        $("#add_shopping_by_text_modal").modal("hide");
                    })
                  });
                } else if(eventType == "place") {
                  $('#place_input').css('display','block');
                  $('#place_title').attr('disabled', false);

                  $('#likedPlace_body').empty();
                  $.ajax({
                            type: "GET",
                            url: "/myPlanner/getLikedPlace",
                            data: {},
                            async: false,
                            success: function(data) {
                                for (var item of data) {
                                    let table_html='';
                                    table_html += '<tr>';
                                    table_html += '  <td>'+item['title']+'</td>';
                                    table_html += '  <td>'+item['road_address_name']+'</td>';
                                    table_html += '</tr>';

                                    $('#likedPlace_body').append(table_html);
                                }
                            }
                  })

                  $("#add_event_modal").modal("show");

                  let placeName;
                  let address;
                  let x;
                  let y;
                  $(document).off('click').on('click', '#likedPlace_body>tr', function(){

                    $('.table-primary').removeClass('table-primary');
                    $(this).addClass('table-primary');

                    var tbody = this.parentNode;
                    var trs = tbody.getElementsByTagName('tr');

                    var tr = $(this);
                    var td = tr.children();

                    placeName = td.eq(0).text();
                    address = td.eq(1).text();

                    $.ajax({
                      type: "GET",
                      url: `/myPlanner/getLikedPlaceXY/${placeName}`,
                      data: {},
                      async: false,
                      success: function(data) {
                        x = data.x;
                        y = data.y;
                      }
                    })
                  });

                  $("#add_event_save").off('click').on("click",function(){  // modal의 일정 추가 버튼 클릭 시 - 장소
                    var title = $("#place_title").val();
                    var start_date = $("#add_event_start_date").val();
                    var start_time = $("#add_event_start_time").val();
                    var end_date = $("#add_event_end_date").val();
                    var end_time = $("#add_event_end_time").val();

                    var allDay = true;
                    if($('input:radio[id=set_time]').is(':checked')){
                      allDay = false;
                    }

                    var start = start_date + " " + start_time;
                    var end = end_date + " " + end_time;

                    //내용 입력 여부 확인
                    if(title == null || title == ""){
                      alert("제목을 입력해주세요.");
                    }else if(placeName == null || placeName == ""){
                      alert("장소를 선택해주세요.");
                    }else if(start_date == "" || end_date ==""){
                      alert("날짜를 입력해주세요.");
                    }else if(new Date(end)- new Date(start) < 0){ // date 타입으로 변경 후 확인
                      alert("종료일이 시작일보다 먼저입니다.");
                    }else{ // 정상적인 입력 시
                      var obj = {
                        "eventType" : "place",
                        "title" : title,
                        "placeName" : placeName,
                        "address" : address,
                        "x" : x,
                        "y" : y,
                        "start" : start,
                        "end" : end,
                        "allDay" : allDay
                      }//전송할 객체 생성
                      var eventPlace = JSON.stringify(obj)
                      console.log(eventPlace);
                      $.ajax({
                        url: "/myPlanner/create_place",
                        method: "POST",
                        dataType: "text",
                        data: eventPlace,
                        contentType: 'application/json',
                        beforeSend : function(xhr) {
                          xhr.setRequestHeader(header, token);
                        },
                        success : function(){
                          alert("등록을 완료하였습니다!");
                        },
                        fail : function (request, status, error){
                          alert("에러 발생" + error)
                        },
                        complete : function(){
                          location.replace("");
                      }
                    })

                    calendar.unselect();
                    }
                  });
                } else if(eventType == "text") {
                  $('#text_input').css('display','block');
                  $('#add_event_text').attr('disabled', false);

                  $("#add_event_modal").modal("show");

                  $("#add_event_save").off('click').on("click",function(){  // modal의 일정 추가 버튼 클릭 시 - text
                    var text = $("#add_event_text").val();
                    var start_date = $("#add_event_start_date").val();
                    var start_time = $("#add_event_start_time").val();
                    var end_date = $("#add_event_end_date").val();
                    var end_time = $("#add_event_end_time").val();

                    var allDay = true;
                    if($('input:radio[id=set_time]').is(':checked')){
                      allDay = false;
                    }

                    var start = start_date + " " + start_time;
                    var end = end_date + " " + end_time;

                    //내용 입력 여부 확인
                    if(text == null || text == ""){
                      alert("내용을 입력해주세요.");
                    }else if(start_date == "" || end_date ==""){
                      alert("날짜를 입력해주세요.");
                    }else if(new Date(end)- new Date(start) < 0){ // date 타입으로 변경 후 확인
                      alert("종료일이 시작일보다 먼저입니다.");
                    }else{ // 정상적인 입력 시
                      var obj = {
                        "eventType" : "text",
                        "title" : text,
                        "start" : start,
                        "end" : end,
                        "allDay" : allDay
                      }//전송할 객체 생성
                      var eventText = JSON.stringify(obj)
                      $.ajax({
                        url: "/myPlanner/create_text",
                        method: "POST",
                        dataType: "text",
                        data: eventText,
                        contentType: 'application/json',
                        beforeSend : function(xhr) {
                          xhr.setRequestHeader(header, token);
                        },
                        success : function(){
                          alert("등록을 완료하였습니다!");
                        },
                        fail : function (request, status, error){
                          alert("에러 발생" + error)
                        },
                        complete : function(){
                          location.replace("");
                      }
                    })

                    calendar.unselect();
                    }
                  });
                }
              } else {
                alert("일정 유형을 선택해 주세요!")
              }

          })
        },
        eventClick: function(arg) {
          $('#vacation_info').css('display','none');
          $('#diet_info').css('display','none');
          $('#shopping_info').css('display','none');
          $('#place_info').css('display','none');
          $('#text_info').css('display','none');

          document.getElementById("info_event_start_date").value = moment(arg.event.start).format('YYYY-MM-DD');
          document.getElementById("info_event_end_date").value = moment(arg.event.end).format('YYYY-MM-DD');
          document.getElementById("info_event_start_time").value = moment(arg.event.start).format('HH:mm');
          document.getElementById("info_event_end_time").value = moment(arg.event.end).format('HH:mm');

          if(arg.event.extendedProps.eventType == "vacation"){
            $('#vacation_info').css('display','block');
          }else if(arg.event.extendedProps.eventType == "diet"){
            $('#diet_info').css('display','block');
            document.getElementById("diet_title_info").value = arg.event.title;
            document.getElementById("food_name_info").value = arg.event.extendedProps.food_name;
            document.getElementById("kcal_info").value = arg.event.extendedProps.kcal;
            document.getElementById("carbohydrate_info").value = arg.event.extendedProps.carbohydrate;
            document.getElementById("protein_info").value = arg.event.extendedProps.protein;
            document.getElementById("fat_info").value = arg.event.extendedProps.fat;
            document.getElementById("sugar_info").value = arg.event.extendedProps.sugar;
            document.getElementById("salt_info").value = arg.event.extendedProps.salt;
            document.getElementById("cholesterol_info").value = arg.event.extendedProps.cholesterol;
            document.getElementById("saturatedFattyAcids_info").value = arg.event.extendedProps.saturatedFattyAcids;
            document.getElementById("transFattyAcids_info").value = arg.event.extendedProps.transFattyAcids;
          }else if(arg.event.extendedProps.eventType == "shopping"){
            $('#shopping_info').css('display','block');
            document.getElementById("shopping_title_info").value = arg.event.title;
            document.getElementById("shopping_name_info").value = arg.event.extendedProps.shopping_name;
            document.getElementById("totalPrice_info").value = arg.event.extendedProps.total_price;
          }else if(arg.event.extendedProps.eventType == "place"){
            $('#place_info').css('display','block');
            document.getElementById("place_title_info").value = arg.event.title;
            document.getElementById("place_name_info").value = arg.event.extendedProps.placeName;
            document.getElementById("place_address_info").value = arg.event.extendedProps.address;

          }else if(arg.event.extendedProps.eventType == "text"){
            $('#text_info').css('display','block');
            document.getElementById("info_event_text").value = arg.event.title;
          }

          $("#info_event_modal").modal("show"); // modal 나타내기

          $("#event_delete").off('click').on("click",function(){
            if(confirm("해당 일정을 삭제하시겠습니까 ?")){
              var obj = {
                "id" : arg.event.id,
                "title" : arg.event.title,
                "start" : arg.event.start,
                "end" : arg.event.end,
                "allDay" : arg.event.allDay
              }//전송할 객체 생성
              var eventText = JSON.stringify(obj)
              $.ajax({
                url: "/myPlanner/delete",
                method: "DELETE",
                dataType: "text",
                data: eventText,
                contentType: 'application/json',
                beforeSend : function(xhr) {
                  xhr.setRequestHeader(header, token);
                },
                success : function(){
				  alert("삭제를 완료하였습니다!");
		        },
                fail : function (request, status, error){
                  alert("에러 발생" + error)
                },
                complete : function(){
                  location.replace("");
                }
              })
            }
          })
        }
      });
      calendar.render();
   });

   function setTimeDisplay(){
     if($('input:radio[id=all_time]').is(':checked')){
        $('#add_event_start_time').val("00:00");
        $('#add_event_start_time').attr("disabled", true);
        $('#add_event_end_time').val("00:00");
        $('#add_event_end_time').attr("disabled", true);
     }else if($('input:radio[id=set_time]').is(':checked')){
        $('#add_event_start_time').attr("disabled", false);
        $('#add_event_end_time').attr("disabled", false);
     }
   }

   function resetExtraInputs() {
      $(".add_event_text_extra").remove();
      $(".btnRemove").remove();
      $("br").remove();
   }

   $('.modal').on('hidden.bs.modal', function (e) {
	 $(this).find('form')[0].reset();
	 setTimeDisplay();
	 resetExtraInputs();
   })

   $('#info_event_modal').on('shown.bs.modal', function() {
     var staticMapContainer  = document.getElementById('staticMap'), // 이미지 지도를 표시할 div
     staticMapOption = {
        center: new kakao.maps.LatLng(33.450701, 126.570667), // 이미지 지도의 중심좌표
        level: 3 // 이미지 지도의 확대 레벨
     };

     // 이미지 지도를 표시할 div와 옵션으로 이미지 지도를 생성합니다
     var staticMap = new kakao.maps.StaticMap(staticMapContainer, staticMapOption);
   });
</script>

